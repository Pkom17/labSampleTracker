<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<head th:replace="~{fragments/header :: head}">
<title></title>
</head>

<body class="sb-nav-fixed">
	<div class="d-flex" id="wrapper">
		<div id="page-content-wrapper">
			<div
				th:insert="~{fragments/header :: header(content='Rapports', module='report')}"></div>
			<div class="container-fluid">
<!-- 				<div class="card mb-4 mt-2"> -->
<!-- 					<div class="card-header"> -->
<!-- 						<h5>Rapports par unité d'organisation</h5> -->
<!-- 					</div> -->
<!-- 					<div class="card-body"> -->
<!-- 						<div class="row mb-2"> -->
<!-- 							<div class="col-lg-3"> -->
<!-- 								<div class="input-group mb-1 mt-2"> -->
<!-- 									<div class="input-group-prepend"> -->
<!-- 										<label class="input-group-text" for="input_start_date1">Date:</label> -->
<!-- 									</div> -->
<!-- 									<input th:value="${selectedStartDate}" type="text" -->
<!-- 										class="form-control form-control-sm" id="input_start_date1" -->
<!-- 										placeholder="Date début" autocomplete="off" /> <label -->
<!-- 										class="input-group-text"> à </label> <input -->
<!-- 										th:value="${selectedEndDate}" type="text" -->
<!-- 										class="form-control form-control-sm" id="input_end_date1" -->
<!-- 										placeholder="Date de fin" autocomplete="off" /> -->
<!-- 								</div> -->
<!-- 							</div> -->
<!-- 							<div class="col-lg-2"> -->
<!-- 								<div class="input-group  mb-1 mt-2"> -->
<!-- 									<div class="input-group-prepend"> -->
<!-- 										<label class="input-group-text" for="selectRegion"> -->
<!-- 											Région: </label> -->
<!-- 									</div> -->
<!-- 									<select class="form-select" id="selectRegion" -->
<!-- 										onchange="getDistrictByRegion(this)"> -->
<!-- 										<option value=""></option> -->
<!-- 										<option th:each="region : ${regions}" th:value="${region.id}" -->
<!-- 											th:text="${region.name}" -->
<!-- 											th:selected="${region.id == selectedRegion}"></option> -->
<!-- 									</select> -->
<!-- 								</div> -->
<!-- 							</div> -->
<!-- 							<div class="col-lg-2"> -->
<!-- 								<div class="input-group  mb-1 mt-2"> -->
<!-- 									<div class="input-group-prepend"> -->
<!-- 										<label class="input-group-text" for="selectDistrict"> -->
<!-- 											Districts: </label> -->
<!-- 									</div> -->
<!-- 									<select class="form-select" id="selectDistrict"> -->
<!-- 										<option value=""></option> -->
<!-- 										<option th:each="district : ${districts}" -->
<!-- 											th:value="${district.id}" th:text="${district.name}" -->
<!-- 											th:selected="${district.id == selectedDistrict}"></option> -->
<!-- 									</select> -->
<!-- 								</div> -->
<!-- 							</div> -->
<!-- 							<div class="col-lg-3"> -->
<!-- 								<div class="input-group  mb-1 mt-2"> -->
<!-- 									<div class="input-group-prepend"> -->
<!-- 										<label class="input-group-text" for="selectSite"> -->
<!-- 											Sites: </label> -->
<!-- 									</div> -->
<!-- 									<select class="form-select" id="selectSite"> -->
<!-- 										<option value=""></option> -->
<!-- 										<option th:each="site : ${sites}" th:value="${site.id}" -->
<!-- 											th:text="${site.name}" -->
<!-- 											th:selected="${site.id == selectedSite}"></option> -->
<!-- 									</select> -->
<!-- 								</div> -->
<!-- 							</div> -->
<!-- 							<div class="col-lg-1"> -->
<!-- 								<div class="input-group mb-1 mt-2"> -->
<!-- 									<button class="btn btn-secondary" id="search" type="button" -->
<!-- 										onclick="filterData();return false;">Imprimer</button> -->
<!-- 								</div> -->
<!-- 							</div> -->
<!-- 						</div> -->
<!-- 					</div> -->
<!-- 				</div> -->
<!-- 				<hr /> -->
<!-- 				<div class="card mb-4 mt-2"> -->
<!-- 					<div class="card-header"> -->
<!-- 						<h5>Rapports par laboratoire</h5> -->
<!-- 					</div> -->
<!-- 					<div class="card-body"> -->
<!-- 						<div class="row mb-2"> -->
<!-- 							<div class="col-lg-3"> -->
<!-- 								<div class="input-group mb-1 mt-2"> -->
<!-- 									<div class="input-group-prepend"> -->
<!-- 										<label class="input-group-text" for="input_start_date2">Date:</label> -->
<!-- 									</div> -->
<!-- 									<input th:value="${selectedStartDate}" type="text" -->
<!-- 										class="form-control form-control-sm" id="input_start_date2" -->
<!-- 										placeholder="Date début" autocomplete="off" /> <label -->
<!-- 										class="input-group-text"> à </label> <input -->
<!-- 										th:value="${selectedEndDate}" type="text" -->
<!-- 										class="form-control form-control-sm" id="input_end_date2" -->
<!-- 										placeholder="Date de fin" autocomplete="off" /> -->
<!-- 								</div> -->
<!-- 							</div> -->
<!-- 							<div class="col-lg-4"> -->
<!-- 								<div class="input-group  mb-1 mt-2"> -->
<!-- 									<div class="input-group-prepend"> -->
<!-- 										<label class="input-group-text" for="selectLab"> -->
<!-- 											Laboratoire: </label> -->
<!-- 									</div> -->
<!-- 									<select class="form-select" id="selectLab"> -->
<!-- 										<option value=""></option> -->
<!-- 										<option th:each="lab : ${labs}" th:value="${lab.id}" -->
<!-- 											th:text="${lab.name}" th:selected="${lab.id == selectedLab}"></option> -->
<!-- 									</select> -->
<!-- 								</div> -->
<!-- 							</div> -->
<!-- 							<div class="col-lg-1"> -->
<!-- 								<div class="input-group mb-1 mt-2"> -->
<!-- 									<button class="btn btn-secondary" id="search" type="button" -->
<!-- 										onclick="reportByRegion();return false;">Imprimer</button> -->
<!-- 								</div> -->
<!-- 							</div> -->
<!-- 						</div> -->
<!-- 					</div> -->
<!-- 				</div> -->
<!-- 				<hr /> -->
				<div class="card mb-4 mt-2">
					<div class="card-header">
						<h5>Rapports par convoyeur</h5>
					</div>
					<div class="card-body">
						<div class="row mb-2">
							<div class="col-lg-3">
								<div class="input-group mb-1 mt-2">
									<div class="input-group-prepend">
										<label class="input-group-text" for="input_start_date3">Date:</label>
									</div>
									<input th:value="${selectedStartDate}" type="text"
										class="form-control form-control-sm" id="input_start_date3"
										placeholder="Date début" autocomplete="off" /> <label
										class="input-group-text"> à </label> <input
										th:value="${selectedEndDate}" type="text"
										class="form-control form-control-sm" id="input_end_date3"
										placeholder="Date de fin" autocomplete="off" />
								</div>
							</div>
							<div class="col-lg-4">
								<div class="input-group  mb-1 mt-2">
									<div class="input-group-prepend">
										<label class="input-group-text" for="selectRider">
											Choisir le convoyeur: </label>
									</div>
									<select class="form-select" id="selectRider">
										<option value=""></option>
										<option th:each="rider : ${riders}" th:value="${rider.id}"
											th:text="${rider.name}"
											th:selected="${rider.id == selectedRider}"></option>
									</select>
								</div>
							</div>
							<div class="col-lg-1">
								<div class="input-group mb-1 mt-2">
									<a id="printRiderReport" class="btn btn-secondary"
										target="_blank" title="Imprimer le rapport" href="#"
										onclick="updateRiderReportUrl(event)">Imprimer &nbsp;<i
										class="fas fa-print"></i></a>

								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<footer class="py-4 bg-light mt-auto"
		th:insert="~{fragments/footer :: footer}"></footer>
	<script th:src="@{/webjars/jquery/3.6.0/jquery.min.js}"></script>
	<script th:src="@{/webjars/jquery-ui/1.13.2/jquery-ui.min.js}"></script>
	<script th:src="@{/webjars/bootstrap/5.1.3/js/bootstrap.min.js}"></script>
	<script th:src="@{/webjars/font-awesome/5.15.4/js/all.js}"></script>
	<script th:src="@{/webjars/select2/4.0.13/js/select2.min.js}"></script>
	<script th:src="@{/DataTables/datatables.min.js}"></script>
	<script th:src="@{/js/scripts.js}"></script>
	<script type="text/javascript">
		var dateFormat = "dd/mm/yy", from = $("#input_start_date1").datepicker({
			changeMonth : true,
			changeYear : true,
			dateFormat : "dd/mm/yy",
		});
		var dateFormat = "dd/mm/yy", from = $("#input_end_date1").datepicker({
			changeMonth : true,
			changeYear : true,
			dateFormat : "dd/mm/yy",
		});
		var dateFormat = "dd/mm/yy", from = $("#input_start_date2").datepicker({
			changeMonth : true,
			changeYear : true,
			dateFormat : "dd/mm/yy",
		});
		var dateFormat = "dd/mm/yy", from = $("#input_end_date2").datepicker({
			changeMonth : true,
			changeYear : true,
			dateFormat : "dd/mm/yy",
		});
		var dateFormat = "dd/mm/yy", from = $("#input_start_date3").datepicker({
			changeMonth : true,
			changeYear : true,
			dateFormat : "dd/mm/yy",
		});
		var dateFormat = "dd/mm/yy", from = $("#input_end_date3").datepicker({
			changeMonth : true,
			changeYear : true,
			dateFormat : "dd/mm/yy",
		});
		function getDate(element) {
			var date;
			try {
				date = $.datepicker.parseDate(dateFormat, element.value);
			} catch (error) {
				date = null;
			}
			return date;
		}

		$(document)
				.ready(
						function() {
							var table = $('#tab_sample')
									.DataTable(
											{
												dom : 'Bfrtip',
												buttons : [
														'csv',
														'excel',
														'pdf',
														{
															orientation : 'landscape',
														} ],
												language : {
													url : "//cdn.datatables.net/plug-ins/2.0.3/i18n/fr-FR.json",
												}
											});
						});
		
		

		$("#selectSite").select2({
			placeholder : "-- Choisir un site --",
			theme : "bootstrap",
			allowClear: true,
		});

		$("#selectDistrict").select2({
			placeholder : "-- Choisir un district --",
			theme : "bootstrap",
			allowClear: true,
		});

		$("#selectRegion").select2({
			placeholder : "-- Choisir une région --",
			theme : "bootstrap",
			allowClear: true,
		});

		$("#selectLab").select2({
			placeholder : "-- Choisir un laboratoire --",
			theme : "bootstrap",
			allowClear: true,
		});

		$("#selectRider").select2({
			placeholder : "-- Choisir un convoyeur --",
			theme : "bootstrap",
			allowClear: true,
		});

		$(document).ready(function() {
			$('#selectRegion').change(function() {
				var selectedRegions = $(this).val();
				populateDistricts(selectedRegions);
			});
			$('#selectDistrict').change(function() {
				var selectDistricts = $(this).val();
				populateSites(selectDistricts);
			});
		});

		function populateDistricts(selectedRegions) {
			$.ajax({
				type : "GET",
				url : "district/names_by_regions?regions=" + selectedRegions,
				success : function(districts) {
					var districtsSelect = $('#selectDistrict');
					districtsSelect.empty();
					districtsSelect.append('<option value=""></option>');
					$.each(districts, function(i, district) {
						districtsSelect
								.append('<option value="' + district.id + '">'
										+ district.name + '</option>');
					});
				}
			});
		}

		function populateSites(selectedDistricts) {
			$.ajax({
				type : "GET",
				url : "site/names_by_districts?districts=" + selectedDistricts,
				success : function(sites) {
					var sitesSelect = $('#selectSite');
					sitesSelect.empty();
					sitesSelect.append('<option value=""></option>');
					$.each(sites, function(i, site) {
						sitesSelect.append('<option value="' + site.id + '">'
								+ site.name + '</option>');
					});
				}
			});
		}
		
	      $(document).on('select2:open', () => {
	          document.querySelector('.select2-search__field').focus();
	        });
		
	     function updateRiderReportUrl(event){
	            var startDate = document.getElementById('input_start_date3').value;
	            var endDate = document.getElementById('input_end_date3').value;
	            var selectedRider = document.getElementById('selectRider').value;
	            
	            if(selectedRider){
	            var url = '/report/print?start=' + encodeURIComponent(startDate) +
	                      '&end=' + encodeURIComponent(endDate) +
	                      '&rider=' + encodeURIComponent(selectedRider);
	            
	            document.getElementById('printRiderReport').href = url;
	            }else{
	            	event.preventDefault();
	            }
	     }
		
	</script>
</body>

</html>